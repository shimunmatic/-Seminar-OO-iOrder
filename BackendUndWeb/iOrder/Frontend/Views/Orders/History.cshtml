@{
    ViewData["Title"] = "Dashboard";
}

<link rel="stylesheet" href="~/css/OrdersPage.css" />
<link rel="stylesheet" href="~/lib/toastr/toastr.min.css" />

<div class="container">
    <div class="row">
        <div class="col-sm-4">

            <div id="ordersList" class="list-group">

            </div>

        </div>

        <div class="col-sm-8">
            <div id="orderDetailsContainer"></div>
        </div>
    </div>
</div>




<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/toastr/toastr.min.js"></script>
<script src='@Url.Content("~/lib/signalr/signalr-client-1.0.0-alpha2-final.js")'></script>
<script type="text/javascript">

    $(document).ready(function () {

        // Fetch orders for the first time
        fetchOrders();

        function fetchOrders() {
            $.get('@Url.Action("Orders", "Orders")', function (orders) {
                var htmlItems = "";
                for (var i = 0; i < orders.length; i++) {
                    var date = new Date(orders[i].date);
                    htmlItems += '<a class="list-group-item orderItem" href="'
                        + orders[i].id
                        + '"><span class="badge">'
                        + date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds()
                        + ' - '
                        + orders[i].orderedProducts.length
                        + '</span>'
                        + orders[i].location.name
                        + '</a>';
                }
                $("#ordersList").html("")
                if (orders.length > 0) $("#ordersList").html(htmlItems);
                else $("#ordersList").html('<a class="list-group-item orderItem" href="#">There are no orders.</a>')
                refreshListeners();
                if (orders.length > 0) selectFirstOrder();
            });
        }

        function refreshListeners() {
           $(".orderItem").click(function (e) {
                e.preventDefault();
                var orderId = $(this).attr("href");
                $("#orderDetailsContainer").load('@Url.Action("Partial", "Orders")'+"/"+orderId);
            });
        }

        function selectFirstOrder() {
            var first = $(".orderItem").first()

            first.click();
            first.css('active');
        }

        function HightlightFirst() {
            var first = $(".orderItem").first();
            first.css('background-color', 'red');
            setTimeout(() => {
                first.css('background-color', 'white');
            },5000);
        }

    });
</script> 